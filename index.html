<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metal Medalhas V23 - Sistema Profissional</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #667eea;
            margin: 0;
            font-size: 28px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            white-space: nowrap;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-config {
            background: #f39c12;
            color: white;
        }

        .btn-report {
            background: #2980b9;
            color: white;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input[type="text"],
        input[type="date"],
        select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            flex: 1;
            min-width: 150px;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            flex: 1;
            min-width: 150px;
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 22px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #667eea;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .card-image {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-image-placeholder {
            font-size: 50px;
            text-align: center;
            color: white;
        }

        .card-content {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 6px;
        }

        .card-id {
            font-weight: bold;
            color: #667eea;
            font-size: 12px;
        }

        .card-status {
            font-size: 16px;
            text-align: right;
        }

        .card-title {
            font-size: 12px;
            font-weight: 500;
            color: #333;
            margin: 0 0 6px 0;
        }

        .card-info {
            font-size: 10px;
            color: #999;
            margin: 1px 0;
        }

        .card-badges {
            display: flex;
            gap: 3px;
            margin-top: 6px;
            flex-wrap: wrap;
        }

        .badge {
            background: #e8f0ff;
            color: #667eea;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: 500;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
            grid-column: 1 / -1;
            font-size: 16px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 12px;
            max-width: 1200px;
            max-height: 95vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: bold;
            color: #667eea;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-weight: 600;
            color: #999;
            transition: all 0.2s;
        }

        .tab-btn.ativo {
            background: #667eea;
            color: white;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.ativo {
            display: block;
        }

        .modal-body {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .modal-image-section {
            text-align: center;
        }

        .modal-image-container {
            width: 100%;
            height: 300px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
            border: 2px dashed #e0e0e0;
        }

        .modal-image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .image-buttons {
            display: flex;
            gap: 8px;
            flex-direction: column;
        }

        .image-buttons button {
            width: 100%;
            padding: 10px;
            font-size: 12px;
        }

        .est√°gio-selector {
            margin-bottom: 20px;
        }

        .est√°gio-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 13px;
        }

        .est√°gio-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 13px;
        }

        .process-steps {
            display: flex;
            gap: 5px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .step {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            min-width: 80px;
        }

        .step.ativo {
            background: #667eea;
            color: white;
        }

        .step.futuro {
            background: #f0f0f0;
            color: #999;
        }

        .step.concluido {
            background: #27ae60;
            color: white;
        }

        .timeline {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
        }

        .timeline-item {
            display: flex;
            gap: 10px;
            padding: 8px;
            margin: 5px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .timeline-item:hover {
            background: #e8f0ff;
        }

        .timeline-item.ativo {
            background: #667eea;
            color: white;
        }

        .timeline-emoji {
            font-size: 14px;
            min-width: 20px;
        }

        .timeline-info {
            text-align: left;
            flex: 1;
        }

        .timeline-nome {
            font-weight: 600;
            font-size: 11px;
        }

        .timeline-data {
            font-size: 10px;
            color: #999;
        }

        .timeline-item.ativo .timeline-data {
            color: rgba(255,255,255,0.8);
        }

        .modal-details h3 {
            color: #999;
            margin: 15px 0 10px 0;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .detail-label {
            color: #999;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
        }

        .detail-value {
            color: #333;
            font-weight: 500;
            margin-top: 3px;
            word-break: break-word;
        }

        .char-tag {
            background: #e8f0ff;
            color: #667eea;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            display: inline-block;
            margin: 2px 2px 2px 0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
            font-size: 12px;
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 10px 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        input[type="checkbox"],
        input[type="radio"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .video-section {
            margin: 15px 0;
        }

        .video-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .video-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            word-break: break-all;
        }

        .video-link:hover {
            text-decoration: underline;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            font-weight: 600;
            z-index: 10000;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        .config-section h2 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .config-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .config-item input {
            flex: 1;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px;
        }

        .config-item button {
            padding: 8px 12px;
            font-size: 11px;
            background: #e74c3c;
            color: white;
        }

        .add-config {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .add-config input {
            flex: 1;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 12px;
        }

        .add-config button {
            padding: 8px 12px;
            background: #27ae60;
            color: white;
            font-size: 11px;
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
            }

            .results {
                grid-template-columns: 1fr;
            }

            .modal-body {
                grid-template-columns: 1fr;
            }

            .search-box {
                flex-direction: column;
            }

            .config-grid {
                grid-template-columns: 1fr;
            }

            input,
            select,
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="mainScreen">
        <div class="container">
            <header>
                <h1>üèÜ Metal Medalhas V23 Pro</h1>
                <div class="header-buttons">
                    <button class="btn-report" onclick="gerarRelatorio()">üìä Relat√≥rio</button>
                    <button class="btn-config" onclick="abrirConfiguracao()">‚öôÔ∏è Config</button>
                    <button class="btn-primary" onclick="location.reload()">üîÑ Recarregar</button>
                </div>
            </header>

            <div class="controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Buscar ID, nome..." onchange="buscar()">
                    <select id="tipoEventoFiltro" onchange="buscar()">
                        <option value="">Todos os eventos</option>
                    </select>
                    <button class="btn-secondary" onclick="limpar()">‚úï Limpar</button>
                    <button class="btn-success" onclick="abrirFormularioNovo()">‚ûï Novo</button>
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalModelos">0</div>
                        <div class="stat-label">Modelos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalRegistros">0</div>
                        <div class="stat-label">Registros</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="encontrados">0</div>
                        <div class="stat-label">Encontrados</div>
                    </div>
                </div>
            </div>

            <div class="results" id="resultados"><div class="loading">‚è≥ Carregando...</div></div>
        </div>
    </div>

    <!-- MODAL CONFIGURA√á√ÉO -->
    <div id="modalConfig" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚öôÔ∏è Configura√ß√µes</div>
                <button class="close-btn" onclick="fecharConfig()">&times;</button>
            </div>

            <div class="config-grid">
                <div class="config-section">
                    <h2>üéØ Tipos de Evento</h2>
                    <div id="configEventos"></div>
                    <div class="add-config">
                        <input type="text" id="novoEvento" placeholder="Ex: Corrida">
                        <button onclick="adicionarEvento()">Adicionar</button>
                    </div>
                </div>

                <div class="config-section">
                    <h2>üíß Tipos de Banho</h2>
                    <div id="configBanhos"></div>
                    <div class="add-config">
                        <input type="text" id="novoBanho" placeholder="Ex: Ouro 18K">
                        <button onclick="adicionarBanho()">Adicionar</button>
                    </div>
                </div>

                <div class="config-section">
                    <h2>üé® Tipos de Fita</h2>
                    <div id="configFitas"></div>
                    <div class="add-config">
                        <input type="text" id="novaFita" placeholder="Ex: Cetim">
                        <button onclick="adicionarFita()">Adicionar</button>
                    </div>
                </div>

                <div class="config-section">
                    <h2>üìê Tamanhos Padr√£o</h2>
                    <div id="configTamanhos"></div>
                    <div class="add-config">
                        <input type="text" id="novoTamanho" placeholder="Ex: 40mm">
                        <button onclick="adicionarTamanho()">Adicionar</button>
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px; text-align: right;">
                <button class="btn-primary" onclick="fecharConfig()">‚úì Fechar</button>
            </div>
        </div>
    </div>

    <!-- MODAL DETALHES -->
    <div id="modalDetalhes" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <div class="modal-title" id="modalTitulo"></div>
                    <div id="modalSubtitulo" style="font-size: 12px; color: #999; margin-top: 5px;"></div>
                </div>
                <button class="close-btn" onclick="fecharModalDetalhes()">&times;</button>
            </div>

            <div class="tabs">
                <button class="tab-btn ativo" onclick="mudarAba('info')">üìã Informa√ß√µes</button>
                <button class="tab-btn" onclick="mudarAba('processos')">‚öôÔ∏è Processos</button>
                <button class="tab-btn" onclick="mudarAba('video')">üé• V√≠deo</button>
            </div>

            <!-- ABA 1: INFORMA√á√ïES -->
            <div id="tab-info" class="tab-content ativo">
                <div class="modal-body">
                    <div class="modal-image-section">
                        <div class="est√°gio-selector">
                            <label>Est√°gio:</label>
                            <select id="est√°gioSelector" onchange="mudarEst√°gio()"></select>
                        </div>

                        <div class="modal-image-container">
                            <img id="modalImg" src="" alt="Imagem">
                        </div>

                        <div class="image-buttons">
                            <button class="btn-secondary" onclick="abrirImagemNova()">üñºÔ∏è Abrir</button>
                            <button class="btn-secondary" onclick="abrirSeletorImagem()">üì∑ Alterar</button>
                        </div>

                        <h3 style="margin-top: 20px; text-align: left;">Hist√≥rico</h3>
                        <div class="timeline" id="timelineEstagios"></div>
                    </div>

                    <div class="modal-details">
                        <h3>üìã B√°sico</h3>
                        <div class="detail-item">
                            <div class="detail-label">ID</div>
                            <div class="detail-value" id="detailId"></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Nome</div>
                            <div class="detail-value" id="detailNome"></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Data</div>
                            <div class="detail-value" id="detailData"></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Tipo</div>
                            <div class="detail-value" id="detailTipo"></div>
                        </div>

                        <h3>üé® Especifica√ß√µes</h3>
                        <div class="detail-item">
                            <div class="detail-label">Tamanho</div>
                            <div class="detail-value" id="detailTamanho"></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Peso</div>
                            <div class="detail-value" id="detailPeso"></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Banho</div>
                            <div class="detail-value" id="detailBanho"></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Resina</div>
                            <div class="detail-value" id="detailResina"></div>
                        </div>
                        <div class="detail-item" id="fitaContainer">
                            <div class="detail-label">Fita</div>
                            <div class="detail-value" id="detailFita"></div>
                        </div>

                        <h3>üìå Evento</h3>
                        <div class="detail-item">
                            <div id="detailTipoEvento"></div>
                        </div>

                        <div class="modal-actions">
                            <button class="btn-primary" onclick="abrirEdicao()">‚úèÔ∏è Editar</button>
                            <button class="btn-secondary" onclick="fecharModalDetalhes()" style="flex: 1;">Fechar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ABA 2: PROCESSOS -->
            <div id="tab-processos" class="tab-content">
                <h3>üîÑ Fluxo de Processos</h3>
                <div class="process-steps" id="processSteps"></div>
                <div class="modal-details">
                    <h3>üìä Status Atual</h3>
                    <div class="detail-item" id="processStatus"></div>
                    <div class="detail-item" id="processHistorico"></div>
                </div>
            </div>

            <!-- ABA 3: V√çDEO -->
            <div id="tab-video" class="tab-content">
                <h3>üé• V√≠deos do Processo</h3>
                <div class="video-section" id="videosList"></div>
                <div style="margin-top: 20px;">
                    <label for="novoVideoLink">Adicionar V√≠deo:</label>
                    <input type="text" id="novoVideoLink" placeholder="https://youtube.com/watch?v=..." style="margin-bottom: 10px;">
                    <button class="btn-success" onclick="adicionarVideo()" style="width: 100%;">‚ûï Adicionar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL FORMUL√ÅRIO -->
    <div id="modalFormulario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚ûï Novo Modelo</div>
                <button class="close-btn" onclick="fecharModalFormulario()">&times;</button>
            </div>

            <form id="formModelo" onsubmit="salvarModelo(event)">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="id">ID *</label>
                        <input type="text" id="id" placeholder="MM-001" required>
                    </div>
                    <div class="form-group">
                        <label for="nome">Nome *</label>
                        <input type="text" id="nome" placeholder="Nome do modelo" required>
                    </div>
                    <div class="form-group">
                        <label for="data">Data *</label>
                        <input type="date" id="data" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>√â Moeda? *</label>
                    <div class="checkbox-item">
                        <input type="radio" name="tipo" id="tipoMedal" value="Medal" checked onchange="atualizarVisibilidadesFita()"> 
                        <label style="margin: 0; font-weight: normal;"> üèÖ Medalha</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="radio" name="tipo" id="tipoMoeda" value="Moeda" onchange="atualizarVisibilidadesFita()"> 
                        <label style="margin: 0; font-weight: normal;"> ü™ô Moeda</label>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="tamanho">Tamanho *</label>
                        <select id="tamanho" required></select>
                    </div>
                    <div class="form-group">
                        <label for="peso">Peso (g) *</label>
                        <input type="number" id="peso" placeholder="Ex: 25" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label for="banho">Banho *</label>
                        <select id="banho" required></select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="resina">Tem Resina?</label>
                        <div class="checkbox-item">
                            <input type="checkbox" id="resina" onchange="atualizarVisibilidadesResina()">
                            <label style="margin: 0; font-weight: normal;"> Sim, adicionar resina</label>
                        </div>
                    </div>
                    <div class="form-group" id="fitaContainer">
                        <label for="fita">Tipo de Fita *</label>
                        <select id="fita" required></select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Tipo de Evento (selecione um ou mais) *</label>
                    <div class="checkbox-group" id="tiposEventoCheckbox"></div>
                </div>

                <div class="form-group">
                    <label for="est√°gio">Est√°gio Inicial *</label>
                    <select id="est√°gio" required>
                        <option value="">Selecione</option>
                        <option value="Matriz">üü¢ Matriz</option>
                        <option value="Fundi√ß√£o">üü° Fundi√ß√£o</option>
                        <option value="Banho">üîµ Banho</option>
                        <option value="Resina">üü£ Resina</option>
                        <option value="Finalizado">‚úÖ Finalizado</option>
                        <option value="Fita">üéÄ Fita</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="foto">Link da Imagem</label>
                    <input type="text" id="foto" placeholder="https://drive.google.com/open?id=...">
                </div>

                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn-success" style="flex: 1;">‚úì Salvar</button>
                    <button type="button" class="btn-secondary" onclick="fecharModalFormulario()" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL SELETOR DE IMAGEM -->
    <div id="modalImagem" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <div class="modal-title">üì∑ Alterar Imagem</div>
                <button class="close-btn" onclick="fecharSeletorImagem()">&times;</button>
            </div>

            <form onsubmit="salvarNovaImagem(event)">
                <div class="form-group">
                    <label>Cole o link do Google Drive:</label>
                    <input type="text" id="novaImagem" placeholder="https://drive.google.com/open?id=..." required>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn-success" style="flex: 1;">‚úì Atualizar</button>
                    <button type="button" class="btn-secondary" onclick="fecharSeletorImagem()" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let todosDados = [];
        let modelos = [];
        let modeloAtual = null;
        let est√°gioAtual = null;
        let tiposEvento = ['Corrida', 'Escolar', 'Empresarial', 'Judo', 'Jiu-Jitsu', 'Boxe', 'Karat√™', 'Nata√ß√£o', 'Futebol', 'Basquete', 'V√¥lei', 'T√™nis', 'Atletismo', 'Gin√°stica', 'Homenagem'];

        let configuracoes = {
            eventos: ['Corrida', 'Escolar', 'Empresarial', 'Judo', 'Jiu-Jitsu', 'Boxe', 'Karat√™', 'Nata√ß√£o', 'Futebol', 'Basquete', 'V√¥lei', 'T√™nis', 'Atletismo', 'Gin√°stica', 'Homenagem'],
            banhos: ['Ouro 18K', 'Prata', 'Bronze', 'Ouro Velho', 'Ouro Antigo'],
            fitas: ['Cetim', 'Fita Organza', 'Fita Sint√©tica', 'Nylon'],
            tamanhos: ['40mm', '50mm', '60mm', '70mm', '80mm', '90mm', '100mm']
        };

        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzIhivAYrQjkVwroYGdYkDpxGa9-otg2JoDypfIh_mZvIkC2h0roPIp7TFYD8oDz6_c/exec';

        function converterLinkDrive(link) {
            if (!link || link === '#') return '';
            const match = link.match(/id=([a-zA-Z0-9-_]+)/);
            if (match) return `https://lh3.googleusercontent.com/d/${match[1]}`;
            return link;
        }

        function carregarConfiguracao() {
            const saved = localStorage.getItem('configuracoes');
            if (saved) {
                configuracoes = JSON.parse(saved);
            }
            localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
        }

        function salvarConfiguracao() {
            localStorage.setItem('configuracoes', JSON.stringify(configuracoes));
            atualizarSelects();
            mostrarNotificacao('‚úÖ Configura√ß√µes salvas!');
        }

        function adicionarEvento() {
            const novo = document.getElementById('novoEvento').value.trim();
            if (novo && !configuracoes.eventos.includes(novo)) {
                configuracoes.eventos.push(novo);
                salvarConfiguracao();
                document.getElementById('novoEvento').value = '';
                renderizarConfig();
            }
        }

        function adicionarBanho() {
            const novo = document.getElementById('novoBanho').value.trim();
            if (novo && !configuracoes.banhos.includes(novo)) {
                configuracoes.banhos.push(novo);
                salvarConfiguracao();
                document.getElementById('novoBanho').value = '';
                renderizarConfig();
            }
        }

        function adicionarFita() {
            const novo = document.getElementById('novaFita').value.trim();
            if (novo && !configuracoes.fitas.includes(novo)) {
                configuracoes.fitas.push(novo);
                salvarConfiguracao();
                document.getElementById('novaFita').value = '';
                renderizarConfig();
            }
        }

        function adicionarTamanho() {
            const novo = document.getElementById('novoTamanho').value.trim();
            if (novo && !configuracoes.tamanhos.includes(novo)) {
                configuracoes.tamanhos.push(novo);
                salvarConfiguracao();
                document.getElementById('novoTamanho').value = '';
                renderizarConfig();
            }
        }

        function removerConfig(tipo, item) {
            const index = configuracoes[tipo].indexOf(item);
            if (index > -1) {
                configuracoes[tipo].splice(index, 1);
                salvarConfiguracao();
                renderizarConfig();
            }
        }

        function renderizarConfig() {
            const renderList = (tipo, items) => {
                return items.map(item => `
                    <div class="config-item">
                        <input type="text" value="${item}" disabled>
                        <button type="button" onclick="removerConfig('${tipo}', '${item}')">‚úï</button>
                    </div>
                `).join('');
            };

            document.getElementById('configEventos').innerHTML = renderList('eventos', configuracoes.eventos);
            document.getElementById('configBanhos').innerHTML = renderList('banhos', configuracoes.banhos);
            document.getElementById('configFitas').innerHTML = renderList('fitas', configuracoes.fitas);
            document.getElementById('configTamanhos').innerHTML = renderList('tamanhos', configuracoes.tamanhos);
        }

        function atualizarSelects() {
            document.getElementById('tamanho').innerHTML = `<option value="">Selecione</option>${configuracoes.tamanhos.map(t => `<option value="${t}">${t}</option>`).join('')}`;
            document.getElementById('banho').innerHTML = `<option value="">Selecione</option>${configuracoes.banhos.map(b => `<option value="${b}">${b}</option>`).join('')}`;
            document.getElementById('fita').innerHTML = `<option value="">Selecione</option>${configuracoes.fitas.map(f => `<option value="${f}">${f}</option>`).join('')}`;
            document.getElementById('tipoEventoFiltro').innerHTML = `<option value="">Todos os eventos</option>${configuracoes.eventos.map(e => `<option value="${e}">${e}</option>`).join('')}`;
        }

        function atualizarVisibilidadesFita() {
            const isMoeda = document.getElementById('tipoMoeda').checked;
            const fitaContainer = document.getElementById('fitaContainer');
            if (isMoeda) {
                fitaContainer.style.display = 'none';
                document.getElementById('fita').required = false;
            } else {
                fitaContainer.style.display = 'block';
                document.getElementById('fita').required = true;
            }
        }

        function atualizarVisibilidadesResina() {
            atualizarVisibilidadesFita();
        }

        function carregarDoGoogleSheets() {
            console.log('üì• Carregando dados...');
            fetch(GOOGLE_APPS_SCRIPT_URL)
                .then(response => response.json())
                .then(data => {
                    todosDados = data;
                    modelos = [...new Map(data.map(item => [item.id, item])).values()];
                    
                    localStorage.setItem('todosDados', JSON.stringify(todosDados));
                    localStorage.setItem('modelos', JSON.stringify(modelos));
                    
                    preencherTiposEvento();
                    exibirResultados(modelos);
                    atualizarStats();
                })
                .catch(err => {
                    console.log('‚ö†Ô∏è Usando locais');
                    todosDados = JSON.parse(localStorage.getItem('todosDados')) || [];
                    modelos = JSON.parse(localStorage.getItem('modelos')) || [];
                    preencherTiposEvento();
                    exibirResultados(modelos);
                    atualizarStats();
                });
        }

        function inicializar() {
            carregarConfiguracao();
            atualizarSelects();
            preencherTiposEvento();
            carregarDoGoogleSheets();
        }

        function preencherTiposEvento() {
            const container = document.getElementById('tiposEventoCheckbox');
            container.innerHTML = configuracoes.eventos.map(tipo => `
                <div class="checkbox-item">
                    <input type="checkbox" name="tipoEvento" value="${tipo}">
                    <label style="margin: 0; font-weight: normal;">${tipo}</label>
                </div>
            `).join('');
        }

        function mudarAba(abaNome) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('ativo'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('ativo'));
            document.getElementById('tab-' + abaNome).classList.add('ativo');
            event.target.classList.add('ativo');
        }

        function buscar() {
            const termo = document.getElementById('searchInput').value.toLowerCase();
            const tipoEvento = document.getElementById('tipoEventoFiltro').value;

            let resultados = modelos.filter(m => {
                const matchTermo = m.id.toLowerCase().includes(termo) || m.nome.toLowerCase().includes(termo);
                const matchTipo = !tipoEvento || (m.tipoEvento && m.tipoEvento.includes(tipoEvento));
                return matchTermo && matchTipo;
            });

            exibirResultados(resultados);
            document.getElementById('encontrados').textContent = resultados.length;
        }

        function limpar() {
            document.getElementById('searchInput').value = '';
            document.getElementById('tipoEventoFiltro').value = '';
            exibirResultados(modelos);
            atualizarStats();
        }

        function atualizarStats() {
            document.getElementById('totalModelos').textContent = modelos.length;
            document.getElementById('totalRegistros').textContent = todosDados.length;
            document.getElementById('encontrados').textContent = modelos.length;
        }

        function exibirResultados(resultados) {
            const container = document.getElementById('resultados');
            if (resultados.length === 0) {
                container.innerHTML = '<div class="no-results">‚ùå Nenhum modelo encontrado.</div>';
                return;
            }

            container.innerHTML = resultados.map(modelo => {
                const est√°giosDoModelo = todosDados.filter(d => d.id === modelo.id);
                const ultimoEst√°gio = est√°giosDoModelo[est√°giosDoModelo.length - 1];
                const imgUrl = converterLinkDrive(ultimoEst√°gio?.foto || modelo.foto);
                
                const imagemHTML = imgUrl 
                    ? `<img src="${imgUrl}" alt="${modelo.nome}" onerror="this.parentElement.innerHTML='<div class=\\'card-image-placeholder\\'>üèÜ</div>'" />`
                    : '<div class="card-image-placeholder">üèÜ</div>';
                
                const tagsHtml = modelo.tipoEvento?.length > 0 ? modelo.tipoEvento.map(t => `<span class="badge">${t}</span>`).join('') : '';
                const resiniHtml = modelo.resina ? '<span class="badge">üü£ Resina</span>' : '';

                return `
                    <div class="card" onclick="abrirDetalhes('${modelo.id}')">
                        <div class="card-image">${imagemHTML}</div>
                        <div class="card-content">
                            <div class="card-header">
                                <div class="card-id">${modelo.id}</div>
                            </div>
                            <div class="card-title">${modelo.nome}</div>
                            <div class="card-info"><strong>${modelo.tamanho}</strong> | ${modelo.peso}g</div>
                            <div class="card-badges">${resiniHtml}${tagsHtml}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function abrirDetalhes(id) {
            modeloAtual = modelos.find(m => m.id === id);
            if (!modeloAtual) return;

            const est√°giosDoModelo = todosDados.filter(d => d.id === id);

            document.getElementById('modalTitulo').textContent = modeloAtual.nome;
            document.getElementById('modalSubtitulo').textContent = `ID: ${modeloAtual.id} ‚Ä¢ ${est√°giosDoModelo.length} etapa(s)`;

            const selector = document.getElementById('est√°gioSelector');
            selector.innerHTML = est√°giosDoModelo.map((e, idx) => `<option value="${idx}">${e.est√°gio || '-'} - ${new Date(e.data).toLocaleDateString('pt-BR')}</option>`).join('');

            const timeline = document.getElementById('timelineEstagios');
            timeline.innerHTML = est√°giosDoModelo.map((e, idx) => `
                <div class="timeline-item ${idx === est√°giosDoModelo.length - 1 ? 'ativo' : ''}" onclick="mudarEst√°gioParaIndex(${idx})">
                    <div class="timeline-emoji">${e.est√°gio?.substring(0,1) || '‚óØ'}</div>
                    <div class="timeline-info">
                        <div class="timeline-nome">${e.est√°gio || '-'}</div>
                        <div class="timeline-data">${new Date(e.data).toLocaleDateString('pt-BR')}</div>
                    </div>
                </div>
            `).join('');

            est√°gioAtual = est√°giosDoModelo[est√°giosDoModelo.length - 1];
            atualizarDetalhesEst√°gio();

            renderizarProcessos();
            renderizarVideos();

            document.getElementById('modalDetalhes').style.display = 'block';
        }

        function mudarEst√°gio() {
            const index = parseInt(document.getElementById('est√°gioSelector').value);
            const est√°giosDoModelo = todosDados.filter(d => d.id === modeloAtual.id);
            est√°gioAtual = est√°giosDoModelo[index];
            
            document.querySelectorAll('.timeline-item').forEach((el, idx) => {
                el.classList.toggle('ativo', idx === index);
            });

            atualizarDetalhesEst√°gio();
        }

        function mudarEst√°gioParaIndex(index) {
            document.getElementById('est√°gioSelector').value = index;
            mudarEst√°gio();
        }

        function atualizarDetalhesEst√°gio() {
            if (!est√°gioAtual) return;

            const imgUrl = converterLinkDrive(est√°gioAtual.foto);
            document.getElementById('modalImg').src = imgUrl || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22300%22 height=%22300%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22300%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2260%22%3EüèÜ%3C/text%3E%3C/svg%3E';

            document.getElementById('detailId').textContent = est√°gioAtual.id;
            document.getElementById('detailNome').textContent = est√°gioAtual.nome;
            document.getElementById('detailData').textContent = new Date(est√°gioAtual.data).toLocaleDateString('pt-BR');
            document.getElementById('detailTipo').textContent = est√°gioAtual.tipo || '-';
            document.getElementById('detailTamanho').textContent = est√°gioAtual.tamanho || '-';
            document.getElementById('detailPeso').textContent = est√°gioAtual.peso ? est√°gioAtual.peso + 'g' : '-';
            document.getElementById('detailBanho').textContent = est√°gioAtual.banho || '-';
            document.getElementById('detailResina').textContent = est√°gioAtual.resina ? '‚úÖ Sim' : '‚ùå N√£o';
            document.getElementById('detailFita').textContent = est√°gioAtual.fita || '-';

            const fitaContainer = document.getElementById('fitaContainer');
            if (est√°gioAtual.tipo === 'Moeda') {
                fitaContainer.style.display = 'none';
            } else {
                fitaContainer.style.display = 'block';
            }

            const tiposHtml = est√°gioAtual.tipoEvento?.length > 0 ? est√°gioAtual.tipoEvento.map(t => `<span class="char-tag">${t}</span>`).join('') : '<span style="color: #999;">-</span>';
            document.getElementById('detailTipoEvento').innerHTML = tiposHtml;
        }

        function renderizarProcessos() {
            const etapas = ['Matriz', 'Fundi√ß√£o', 'Banho', 'Resina', 'Finalizado', 'Fita'];
            const est√°giosDoModelo = todosDados.filter(d => d.id === modeloAtual.id).map(d => d.est√°gio);
            
            const stepsHTML = etapas.map(etapa => {
                const temEtapa = est√°giosDoModelo.includes(etapa);
                const ativo = est√°gioAtual?.est√°gio === etapa;
                const classe = ativo ? 'ativo' : (temEtapa ? 'concluido' : 'futuro');
                const emoji = {
                    'Matriz': 'üü¢',
                    'Fundi√ß√£o': 'üü°',
                    'Banho': 'üîµ',
                    'Resina': 'üü£',
                    'Finalizado': '‚úÖ',
                    'Fita': 'üéÄ'
                }[etapa] || '‚ö™';
                
                return `<div class="step ${classe}">${emoji} ${etapa}</div>`;
            }).join('');

            document.getElementById('processSteps').innerHTML = stepsHTML;
            document.getElementById('processStatus').textContent = 'üìå Est√°gio Atual: ' + (est√°gioAtual?.est√°gio || '-');
            document.getElementById('processHistorico').innerHTML = `<strong>Hist√≥rico:</strong> ${est√°giosDoModelo.join(' ‚Üí ') || '-'}`;
        }

        function renderizarVideos() {
            const videos = modeloAtual.videos || [];
            const videosList = document.getElementById('videosList');
            
            if (videos.length === 0) {
                videosList.innerHTML = '<p style="color: #999;">Nenhum v√≠deo adicionado</p>';
                return;
            }

            videosList.innerHTML = videos.map((video, idx) => `
                <div class="video-item">
                    <a href="${video}" target="_blank" class="video-link">üé• V√≠deo ${idx + 1}</a>
                    <button type="button" onclick="removerVideo(${idx})" style="background: #e74c3c; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer;">‚úï</button>
                </div>
            `).join('');
        }

        function adicionarVideo() {
            const link = document.getElementById('novoVideoLink').value.trim();
            if (!link) {
                mostrarNotificacao('‚ö†Ô∏è Cole um link v√°lido');
                return;
            }

            if (!modeloAtual.videos) {
                modeloAtual.videos = [];
            }
            modeloAtual.videos.push(link);
            
            const index = modelos.findIndex(m => m.id === modeloAtual.id);
            if (index >= 0) {
                modelos[index].videos = modeloAtual.videos;
            }
            localStorage.setItem('modelos', JSON.stringify(modelos));
            
            document.getElementById('novoVideoLink').value = '';
            renderizarVideos();
            mostrarNotificacao('‚úÖ V√≠deo adicionado!');
        }

        function removerVideo(idx) {
            if (modeloAtual.videos) {
                modeloAtual.videos.splice(idx, 1);
                const index = modelos.findIndex(m => m.id === modeloAtual.id);
                if (index >= 0) {
                    modelos[index].videos = modeloAtual.videos;
                }
                localStorage.setItem('modelos', JSON.stringify(modelos));
                renderizarVideos();
                mostrarNotificacao('‚úÖ V√≠deo removido!');
            }
        }

        function fecharModalDetalhes() {
            document.getElementById('modalDetalhes').style.display = 'none';
        }

        function abrirImagemNova() {
            const imgUrl = converterLinkDrive(est√°gioAtual.foto);
            if (imgUrl) {
                window.open(imgUrl, '_blank');
            } else {
                mostrarNotificacao('‚ö†Ô∏è Sem imagem');
            }
        }

        function abrirSeletorImagem() {
            document.getElementById('modalImagem').style.display = 'block';
        }

        function fecharSeletorImagem() {
            document.getElementById('modalImagem').style.display = 'none';
            document.getElementById('novaImagem').value = '';
        }

        function salvarNovaImagem(event) {
            event.preventDefault();
            const novaFoto = document.getElementById('novaImagem').value;

            if (est√°gioAtual && novaFoto) {
                est√°gioAtual.foto = novaFoto;
                const index = todosDados.findIndex(d => d.id === est√°gioAtual.id && d.est√°gio === est√°gioAtual.est√°gio);
                if (index >= 0) {
                    todosDados[index].foto = novaFoto;
                }
                
                localStorage.setItem('todosDados', JSON.stringify(todosDados));
                atualizarDetalhesEst√°gio();
                
                mostrarNotificacao('üì∑ Imagem atualizada!');
                fecharSeletorImagem();
                exibirResultados(modelos);
            }
        }

        function abrirFormularioNovo() {
            document.getElementById('formModelo').reset();
            document.getElementById('id').disabled = false;
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('data').value = hoje;
            document.getElementById('tipoMedal').checked = true;
            atualizarVisibilidadesFita();
            
            modeloAtual = null;
            document.getElementById('modalFormulario').style.display = 'block';
        }

        function fecharModalFormulario() {
            document.getElementById('modalFormulario').style.display = 'none';
        }

        function salvarModelo(event) {
            event.preventDefault();

            const tiposEventoSelecionados = Array.from(document.querySelectorAll('input[name="tipoEvento"]:checked')).map(cb => cb.value);
            const tipo = document.querySelector('input[name="tipo"]:checked').value;

            const novoRegistro = {
                id: document.getElementById('id').value.toUpperCase(),
                nome: document.getElementById('nome').value,
                tipo: tipo,
                data: document.getElementById('data').value,
                tamanho: document.getElementById('tamanho').value,
                peso: parseFloat(document.getElementById('peso').value) || null,
                banho: document.getElementById('banho').value,
                resina: document.getElementById('resina').checked,
                fita: tipo === 'Moeda' ? null : document.getElementById('fita').value,
                tipoEvento: tiposEventoSelecionados,
                est√°gio: document.getElementById('est√°gio').value,
                foto: document.getElementById('foto').value || '#',
                videos: []
            };

            todosDados.push(novoRegistro);
            const jaExiste = modelos.find(m => m.id === novoRegistro.id);
            if (!jaExiste) {
                modelos.push(novoRegistro);
            }

            localStorage.setItem('todosDados', JSON.stringify(todosDados));
            localStorage.setItem('modelos', JSON.stringify(modelos));

            mostrarNotificacao('‚úÖ Modelo salvo!');
            fecharModalFormulario();
            exibirResultados(modelos);
            atualizarStats();
        }

        function abrirEdicao() {
            if (!est√°gioAtual) return;
            document.getElementById('id').value = est√°gioAtual.id;
            document.getElementById('id').disabled = true;
            document.getElementById('nome').value = est√°gioAtual.nome;
            document.getElementById('data').value = est√°gioAtual.data;
            document.getElementById('tamanho').value = est√°gioAtual.tamanho || '';
            document.getElementById('peso').value = est√°gioAtual.peso || '';
            document.getElementById('banho').value = est√°gioAtual.banho || '';
            document.getElementById('resina').checked = est√°gioAtual.resina || false;
            document.getElementById('fita').value = est√°gioAtual.fita || '';
            document.getElementById('est√°gio').value = est√°gioAtual.est√°gio || '';
            document.getElementById('foto').value = est√°gioAtual.foto !== '#' ? est√°gioAtual.foto : '';

            if (est√°gioAtual.tipo === 'Moeda') {
                document.getElementById('tipoMoeda').checked = true;
            } else {
                document.getElementById('tipoMedal').checked = true;
            }
            atualizarVisibilidadesFita();

            document.querySelectorAll('input[name="tipoEvento"]').forEach(cb => {
                cb.checked = est√°gioAtual.tipoEvento && est√°gioAtual.tipoEvento.includes(cb.value);
            });

            fecharModalDetalhes();
            document.getElementById('modalFormulario').style.display = 'block';
        }

        function abrirConfiguracao() {
            renderizarConfig();
            document.getElementById('modalConfig').style.display = 'block';
        }

        function fecharConfig() {
            document.getElementById('modalConfig').style.display = 'none';
        }

        function gerarRelatorio() {
            const tipoEvento = document.getElementById('tipoEventoFiltro').value;
            if (!tipoEvento) {
                mostrarNotificacao('‚ö†Ô∏è Selecione um tipo de evento');
                return;
            }

            const filtrados = modelos.filter(m => m.tipoEvento && m.tipoEvento.includes(tipoEvento));
            
            if (filtrados.length === 0) {
                mostrarNotificacao('‚ùå Nenhum modelo encontrado');
                return;
            }

            exibirResultados(filtrados);
            mostrarNotificacao(`üìä Filtrado: ${filtrados.length} modelo(s) para "${tipoEvento}"`);
        }

        function mostrarNotificacao(mensagem) {
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.textContent = mensagem;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        window.onclick = function(event) {
            if (event.target.id === 'modalDetalhes') fecharModalDetalhes();
            if (event.target.id === 'modalFormulario') fecharModalFormulario();
            if (event.target.id === 'modalImagem') fecharSeletorImagem();
            if (event.target.id === 'modalConfig') fecharConfig();
        }

        inicializar();
    </script>
</body>
</html>
